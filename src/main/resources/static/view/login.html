<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <link rel="stylesheet" href="http://cdn.bootcss.com/normalize/7.0.0/normalize.min.css"/>
  <link rel="stylesheet" href="../layui-v2.2.5/layui/css/layui.css">
  <link rel="stylesheet" href="../css/main.css"/>
  <link rel="stylesheet" href="../css/verificationCode.css">
  <script src="../layui-v2.2.5/layui/layui.js"></script>
  <script src="../js/verificationCode.js"></script>
  <title>用户登录界面</title>
  <script src="../js/jquery-1.10.1.js"></script>
</head>
<body>
  <div class="re_main">
    <div class="re_up">
      <h2 id="re_title">飞马管理系统登录界面</h2>
    </div>
    <div class="re_body">
      <div class="re_logo">
        <div class="re_img"><img src="../images/1.png" height="88" width="132"/></div>
        <h2>飞马科技</h2>
      </div>
      <div class="re_nav">
        <form action="" class="layui-form" id="f">
          <div class="layui-form-item">
            <label class="layui-form-label">登&nbsp;录&nbsp;名:</label>
            <div class="layui-input-inline">
              <input name="loginname" lay-verify="required|loginname" placeholder="登录名" autocomplete="off" class="layui-input" type="text" th:field="*{loginname}">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码:</label>
            <div class="layui-input-inline">
              <input name="password"  lay-verify="required|password" placeholder="密码" autocomplete="off" class="layui-input" type="password" th:field="*{pll}">
            </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">验&nbsp;证&nbsp;码:</label>
            <div class="layui-input-inline">
              <div id="dragContainer">
                <div id="dragBg"></div>
                <div id="dragText"></div>
                <div id="dragHandler" class="dragHandlerBg"></div>
              </div>
            </div>
          </div>
          <div class="layui-form-item">
            <div class="layui-input-block">
              <button class="layui-btn" lay-submit="" lay-filter="demo1" type="submit" id="demo1">登录</button>
            </div>
          </div>
        </form>
        <a href="register.html" class="re_href">没有账号？注册一个</a>
      </div>
    </div>
    <div class="re_down">
      <h2>@版权所用飞马科技</h2></div>
    </div>
  </div>
  <script src="../layui-v2.2.5/layui/layui.js"></script>
  <script>
      layui.use('form', function(){
          var flag = 0;
          var form = layui.form;
          //自定义验证规则
          form.verify({
              loginname: function(value){
                  if(flag==-1) {
                      flag=0;
                      return '用户不存在';
                  }
              }
              ,password: function(value) {
                  if(flag==1){
                      flag=0;
                      return '密码不正确';
                  }
              }
          });

          //监听提交
          form.on('submit(demo1)', function(data){
              $.ajax({
                  url:"../loginAndRegisterCtrl/login",
                  type:"post",
                  data : $("#f").serialize(),//将对应form表单的所有可输入内容全部序列化
                  dataType:"JSON",
                  success:function(msg)
                  {
                      flag=msg.errorCode;
                      if(flag==0){
                          location.href="/jump/memberManagement";
                      }else{
                          $("#demo1").click();
                      }
                  },
                  error:function()
                  {
                      alert("ajax传送有错");
                  }
              });
              return false;
          });
      });

  </script>
</body>
</html>
